<!DOCTYPE html>
<html>
<head>
    <title>Analytics</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel = "icon" href ="/assets/img/logo.svg" type = "image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Link to custom style -->
    <link rel="stylesheet" href="/assets/ui/css/style.css"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700&display=swap" rel="stylesheet">

<!--    Link firebase-->
    <script src="https://www.gstatic.com/firebasejs/4.3.0/firebase.js"></script>

    <!-- Link to boostrap style -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- Link to boostrap javascript -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <!-- Link to socket.io -->
    <script src="/assets/socket.io.js"></script>

    <!--    Font awesome link-->
    <script src="https://kit.fontawesome.com/abcc6b2fc6.js" crossorigin="anonymous"></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
</head>
<body>

<div class="overlay js-overlay">
    <img class="chart-loading" src="/assets/img/pie-chart-loading.gif" />
</div>

<div class="container-xxl p-0 homepage">
    <nav class="navbar navbar-expand-lg navbar-light p-2 p-sm-3 p-md-3 p-lg-3 p-xl-0">
        <a class="navbar-brand" href="/">
            <img class="navbar__logo" src="/assets/img/logo.svg" alt="logo">
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse flex-row-reverse" id="navbarTogglerDemo03">
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item d-flex flex-row align-items-center px-3">
                    <i class="fas fa-home"></i>
                    <a class="nav-link m-2" href="/">Overview</a>
                </li>
                <li class="nav-item d-flex flex-row align-items-center px-3 active">
                    <i class="fas fa-chart-bar"></i>
                    <a class="nav-link m-2 active" href="/analytics">Analytics</a>
                </li>
                <li class="nav-item d-flex flex-row align-items-center px-3">
                    <i class="fas fa-image"></i>
                    <a class="nav-link m-2" href="#">Gallery</a>
                </li>
                <li class="nav-item d-flex flex-row align-items-center px-3">
                    <i class="fas fa-cog"></i>
                    <a class="nav-link m-2" href="#">Settings</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="overview__container p-2 p-sm-3 p-md-3 p-lg-3 p-xl-0">
        <h2 class="overview__title py-4">Analytics</h2>
        <div id="temperature"></div>
        <div id="humidity"></div>
        <div id="co2"></div>
        <div id="co"></div>
    </div>

</div>

<!-- Link to custom javascript -->
<script src="/assets/ui/js/main.js"></script>
<script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
<script>
    const $overlay = $(".js-overlay");
    const firebaseConfig = {
        apiKey: "AIzaSyD3qooGTPdXGN6NBDSpNZteiwGOpgkJZzY",
        authDomain: "licenta-3e164.firebaseapp.com",
        databaseURL: "https://licenta-3e164-default-rtdb.firebaseio.com",
        projectId: "licenta-3e164",
        storageBucket: "licenta-3e164.appspot.com",
        messagingSenderId: "987851035034",
        appId: "1:987851035034:web:825ea9c221d2d8933c2a23",
        measurementId: "G-9SKBFKBX69"
    };

    firebase.initializeApp(firebaseConfig);

    let temperatureArray =  [['Hour', `Â°C`]];
    let humidityArray =  [['Hour', '%']];
    let CO2Array =  [['Hour', `ppm`]];
    let COArray =  [['Hour', 'ppm']];
    let dateValue ='';

    var userDataRefTemperatureSensor = firebase.database()
        .ref("sensors/temperature-and-humidity")
        .limitToLast(1)
        .on('child_added', function(snapshot) {
            let index=-1;
            dateValue=snapshot.key;
            snapshot.forEach((child) => {
                index+=1;
                temperatureArray.push([Object.keys(snapshot.val())[index], +child.val().temperature]);
                humidityArray.push([Object.keys(snapshot.val())[index], +child.val().humidity]);
            });
            $overlay.hide();
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawTemperatureChart);
            google.charts.setOnLoadCallback(drawHumidityChart);
        })

    var userDataRefSmokeSensor = firebase.database()
        .ref("sensors/smoke")
        .limitToLast(1)
        .on('child_added', function(snapshot) {
            let index=-1;
            dateValue=snapshot.key;
            snapshot.forEach((child) => {
                index+=1;
                CO2Array.push([Object.keys(snapshot.val())[index], +child.val().CO2]);
                COArray.push([Object.keys(snapshot.val())[index], +child.val().CO]);
            });
            $overlay.hide();
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawCOChart);
            google.charts.setOnLoadCallback(drawCO2Chart);
        })

    function drawTemperatureChart() {
        var data = google.visualization.arrayToDataTable(temperatureArray);

        var options = {
            title: `Temperature(${dateValue})`,
            titleTextStyle: {
                color: 'white'
            },
            hAxis: {
                title: 'Hour',
                textStyle : {
                    color: 'white',
                },
                titleTextStyle: {
                    color: 'white',
                    bold: true,
                    italic: false
                }
            },
            vAxis: {
                minValue: 0,
                textStyle: {
                    color:'white'
                }
            },
            backgroundColor: '#2D384F',
            legend: {
                textStyle: {
                    color: 'white'
                }
            }
        };
        $("#temperature").css({'width':'100%','height':'500px'});
        var chart = new google.visualization.AreaChart(document.getElementById('temperature'));
        chart.draw(data, options);
    }
    function drawHumidityChart() {
        var data = google.visualization.arrayToDataTable(humidityArray);

        var options = {
            title: `Humidity(${dateValue})`,
            titleTextStyle: {
                color: 'white'
            },
            hAxis: {
                title: 'Hour',
                textStyle : {
                    color: 'white',
                },
                titleTextStyle: {
                    color: 'white',
                    bold: true,
                    italic: false
                }
            },
            vAxis: {
                minValue: 0,
                textStyle: {
                    color:'white'
                }
            },
            backgroundColor: '#2D384F',
            legend: {
                textStyle: {
                    color: 'white'
                }
            }
        };
        $("#humidity").css({'width':'100%','height':'500px'});
        var chart = new google.visualization.AreaChart(document.getElementById('humidity'));
        chart.draw(data, options);
    }
    function drawCOChart() {
        var data = google.visualization.arrayToDataTable(COArray);

        var options = {
            title: `CO(${dateValue})`,
            titleTextStyle: {
                color: 'white'
            },
            hAxis: {
                title: 'Hour',
                textStyle : {
                    color: 'white',
                },
                titleTextStyle: {
                    color: 'white',
                    bold: true,
                    italic: false
                }
            },
            vAxis: {
                minValue: 0,
                textStyle: {
                    color:'white'
                }
            },
            backgroundColor: '#2D384F',
            legend: {
                textStyle: {
                    color: 'white'
                }
            }
        };
        $("#co").css({'width':'100%','height':'500px'});
        var chart = new google.visualization.AreaChart(document.getElementById('co'));
        chart.draw(data, options);
    }
    function drawCO2Chart() {
        var data = google.visualization.arrayToDataTable(CO2Array);

        var options = {
            title: `CO2(${dateValue})`,
            titleTextStyle: {
                color: 'white'
            },
            hAxis: {
                title: 'Hour',
                textStyle : {
                    color: 'white',
                },
                titleTextStyle: {
                    color: 'white',
                    bold: true,
                    italic: false
                }
            },
            vAxis: {
                minValue: 0,
                textStyle: {
                    color:'white'
                }
            },
            backgroundColor: '#2D384F',
            legend: {
                textStyle: {
                    color: 'white'
                }
            }
        };
        $("#co2").css({'width':'100%','height':'500px'});
        var chart = new google.visualization.AreaChart(document.getElementById('co2'));
        chart.draw(data, options);
    }
</script>
</body>
</html>